

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Avalon DataLab &#8212; Avalon DataLab</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'AvalonDataLab';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Allegiance Consulting" href="home.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to Avalon DataLab
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="home.html">Allegiance Consulting</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Avalon DataLab</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/ryanblumenow/avalondatalab/blob/gh-pages/AvalonDataLab.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/AvalonDataLab.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Avalon DataLab</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="avalon-datalab">
<h1>Avalon DataLab<a class="headerlink" href="#avalon-datalab" title="Permalink to this heading">#</a></h1>
<right>
<img src="https://www.allegiance.co.za/img/allegiance/allegiance_logo_new.png" width=180>
</right><h3 align="left"><font color='teal'>Read in data and prepare analytical environment</font></h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pyodbc
<span class="kn">import</span> <span class="nn">pyodbc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="c1"># Suppress UserWarning from pandas</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>

<span class="c1"># # Connect to SQL Server</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;DRIVER={SQL Server};&#39;</span>
                      <span class="s1">&#39;SERVER=db1-dev-int-jhb.avalon.co.za;&#39;</span>
                      <span class="s1">&#39;DATABASE=dev.avalon.libertygroup;&#39;</span>
                      <span class="s1">&#39;UID=AzureADAdmin;&#39;</span>
                      <span class="s1">&#39;PWD=@ll3g!Anc#.C).z@&#39;</span><span class="p">)</span>
                      
<span class="c1"># Retrieve data from SQL tables</span>
<span class="n">df_clients</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM tbl_individual_clients&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df_income</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM tbl_individual_income&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df_liabilities</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM tbl_individual_liabilities&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df_holdings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM tbl_holdings&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df_assets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM tbl_individual_assets&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df_users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM tblusers&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="n">df_clients</span> <span class="o">=</span> <span class="n">df_clients</span><span class="p">[</span><span class="n">df_clients</span><span class="o">.</span><span class="n">gender</span> <span class="o">!=</span> <span class="s1">&#39;Joint&#39;</span><span class="p">]</span>
<span class="n">df_clients</span> <span class="o">=</span> <span class="n">df_clients</span><span class="p">[</span><span class="n">df_clients</span><span class="o">.</span><span class="n">gender</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Clean and preprocess data</span>
<span class="k">def</span> <span class="nf">clean_data</span><span class="p">(</span><span class="n">df_clients</span><span class="p">,</span> <span class="n">df_income</span><span class="p">,</span> <span class="n">df_liabilities</span><span class="p">):</span>
    <span class="c1"># Drop PII data</span>
    <span class="n">df_clients</span> <span class="o">=</span> <span class="n">df_clients</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;firstname&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="s1">&#39;emailaddress&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#     # Merge data</span>
<span class="c1">#     df = pd.merge(df_clients, df_income, on=&#39;individualclientid&#39;)</span>
<span class="c1">#     df = pd.merge(df, df_liabilities, on=&#39;individualclientid&#39;)</span>

<span class="c1">#     # Rename columns</span>
<span class="c1">#     df = df.rename(columns={&#39;age_x&#39;: &#39;age&#39;, &#39;amount_x&#39;: &#39;income&#39;, &#39;amount_y&#39;: &#39;liabilities&#39;})</span>

<span class="c1">#     return df</span>

<span class="c1"># df = clean_data(df_clients, df_income, df_liabilities)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[notice] A new release of pip available: 22.3.1 -&gt; 23.1.2
[notice] To update, run: python.exe -m pip install --upgrade pip
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pyodbc in c:\users\ryanblumenow\appdata\local\programs\python\python310\lib\site-packages (4.0.39)
</pre></div>
</div>
</div>
</div>
<p>Initial EDA (unguided)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dtale</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="c1"># Suppress FutureWarning from pandas</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="n">clients</span> <span class="o">=</span> <span class="n">dtale</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">df_clients</span><span class="p">)</span>

<span class="c1"># Define the functions for each option</span>
<span class="k">def</span> <span class="nf">option1</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Viewing client data&quot;</span><span class="p">)</span>
    <span class="n">dtale</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">df_clients</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">option2</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Option 2 selected&quot;</span><span class="p">)</span>
    <span class="c1"># Code for option 2</span>

<span class="k">def</span> <span class="nf">option3</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Option 3 selected&quot;</span><span class="p">)</span>
    <span class="c1"># Code for option 3</span>

<span class="c1"># Create dropdown widget</span>
<span class="n">dropdown</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Clients&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Option 2&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Option 3&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Select an option:&#39;</span>
<span class="p">)</span>

<span class="c1"># Create button widget</span>
<span class="n">button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Run Code&#39;</span><span class="p">)</span>

<span class="c1"># Create output widget</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>

<span class="c1"># Define event handlers</span>
<span class="k">def</span> <span class="nf">dropdown_event_handler</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="n">option_value</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span>
        <span class="k">if</span> <span class="n">option_value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">option1</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">option_value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">option2</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">option_value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">option3</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">button_event_handler</span><span class="p">(</span><span class="n">button</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="n">option_value</span> <span class="o">=</span> <span class="n">dropdown</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">option_value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">option1</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">option_value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">option2</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">option_value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">option3</span><span class="p">()</span>

<span class="c1"># Register event handlers</span>
<span class="n">dropdown</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">dropdown_event_handler</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">button_event_handler</span><span class="p">)</span>

<span class="c1"># Display widgets</span>
<span class="n">display</span><span class="p">(</span><span class="n">dropdown</span><span class="p">)</span>
<span class="c1"># display(button)</span>
<span class="n">display</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="ne">C</span>:\Users\RYANBL~1\AppData\Local\Temp/ipykernel_16648/392929638.py in &lt;module&gt;
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">dtale</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Suppress FutureWarning from pandas</span>

<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Programs</span>\<span class="n">Python</span>\<span class="n">Python310</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">dtale</span>\<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">warnings</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>

<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Programs</span>\<span class="n">Python</span>\<span class="n">Python310</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">flask</span>\<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">json</span> <span class="k">as</span> <span class="n">json</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">.app</span> <span class="kn">import</span> <span class="n">Flask</span> <span class="k">as</span> <span class="n">Flask</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">.app</span> <span class="kn">import</span> <span class="n">Request</span> <span class="k">as</span> <span class="n">Request</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">from</span> <span class="nn">.app</span> <span class="kn">import</span> <span class="n">Response</span> <span class="k">as</span> <span class="n">Response</span>

<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Programs</span>\<span class="n">Python</span>\<span class="n">Python310</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">flask</span>\<span class="n">app</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="kn">from</span> <span class="nn">werkzeug.wrappers</span> <span class="kn">import</span> <span class="n">Response</span> <span class="k">as</span> <span class="n">BaseResponse</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> 
<span class="ne">---&gt; </span><span class="mi">34</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">cli</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">typing</span> <span class="k">as</span> <span class="n">ft</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span> <span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Programs</span>\<span class="n">Python</span>\<span class="n">Python310</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">flask</span>\<span class="n">cli</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> 
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">import</span> <span class="nn">click</span>
<span class="ne">---&gt; </span><span class="mi">15</span> <span class="kn">from</span> <span class="nn">click.core</span> <span class="kn">import</span> <span class="n">ParameterSource</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">werkzeug</span> <span class="kn">import</span> <span class="n">run_simple</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span> <span class="nn">werkzeug.serving</span> <span class="kn">import</span> <span class="n">is_running_from_reloader</span>

<span class="ne">ImportError</span>: cannot import name &#39;ParameterSource&#39; from &#39;click.core&#39; (C:\Users\RyanBlumenow\AppData\Local\Programs\Python\Python310\lib\site-packages\click\core.py)
</pre></div>
</div>
</div>
</div>
<p>Ongoing EDA</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform exploratory data analysis</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df_clients</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;gender&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Convert categorical variables to numerical values using one-hot encoding</span>
<span class="n">df_clients_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df_clients</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">])</span>

<span class="c1"># Cluster data based on demographic groups</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_clients_encoded</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;maritalstatus_Single&#39;</span><span class="p">,</span> <span class="s1">&#39;maritalstatus_Married&#39;</span><span class="p">,</span> <span class="s1">&#39;maritalstatus_Divorced&#39;</span><span class="p">]]</span>
<span class="c1"># Create an imputer object with mean strategy</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="c1"># Impute missing values in the X DataFrame</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">df_clients</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>

<span class="c1"># Analyze and correlate clustered data with investments</span>
<span class="c1"># Field names hidden for aesthetics</span>
<span class="c1"># print(df_clients.columns)</span>
<span class="c1"># print(df_holdings.columns)</span>
<span class="c1"># print(df_assets.columns)</span>
<span class="n">df_holdings</span> <span class="o">=</span> <span class="n">df_holdings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clientid&#39;</span><span class="p">:</span> <span class="s1">&#39;individualclientid&#39;</span><span class="p">})</span>
<span class="n">df_holdings_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_holdings</span><span class="p">,</span> <span class="n">df_clients</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;individualclientid&#39;</span><span class="p">)</span>
<span class="n">df_assets_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_assets</span><span class="p">,</span> <span class="n">df_clients</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;individualclientid&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_holdings_by_cluster</span><span class="p">():</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;holdingsvalue&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_holdings_merged</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">plot_assets_by_cluster</span><span class="p">():</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_assets_merged</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/339713381e523c8764c1a44392fd65e3bc3aa8256ebf3a22fb539caf8cea1059.png" src="_images/339713381e523c8764c1a44392fd65e3bc3aa8256ebf3a22fb539caf8cea1059.png" />
</div>
</div>
<p>Analyzing incomes and liabilities across ages</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Dashboard prototype</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="c1"># Load data</span>
<span class="n">clients</span> <span class="o">=</span> <span class="n">df_clients</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">df_income</span>
<span class="n">liabilities</span> <span class="o">=</span> <span class="n">df_liabilities</span>

<span class="c1"># Merge data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">clients</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;individualclientid&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">liabilities</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;individualclientid&#39;</span><span class="p">)</span>

<span class="c1"># Define the function to filter the data based on age and display a scatterplot</span>
<span class="k">def</span> <span class="nf">plot_income_liabilities</span><span class="p">(</span><span class="n">min_age</span><span class="p">,</span> <span class="n">max_age</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_age</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_age</span><span class="p">)]</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;amount_x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;debtamount&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">filtered_df</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: No data found for the specified age range.&#39;</span><span class="p">)</span>

<span class="n">min_age_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;min_age&#39;</span><span class="p">)</span>
<span class="n">max_age_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;max_age&#39;</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive_output</span><span class="p">(</span><span class="n">plot_income_liabilities</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;min_age&#39;</span><span class="p">:</span> <span class="n">min_age_slider</span><span class="p">,</span> <span class="s1">&#39;max_age&#39;</span><span class="p">:</span> <span class="n">max_age_slider</span><span class="p">})</span>

<span class="n">display</span><span class="p">(</span><span class="n">min_age_slider</span><span class="p">,</span> <span class="n">max_age_slider</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "618e26d32a5b4917b5bf3662ae64714f", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "776df4c3eeda450ab994c8b5ec68c011", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "0de1e41b305d45f78469fdb97b0de0cc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Analyzing demographics of clients per advisor</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge data</span>
<span class="n">df_users</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;User_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;userid&#39;</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_clients</span><span class="p">,</span> <span class="n">df_users</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;userid&#39;</span><span class="p">)</span>

<span class="n">df_users</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_users</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">df_users</span><span class="p">[</span><span class="s1">&#39;Surname&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_users</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">])</span>

<span class="c1"># Assign codes to categorical variables</span>
<span class="n">marital_status_codes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Married&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Single&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Divorced&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Widowed&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;maritalstatus_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">marital_status_codes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">marital_status_codes</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">gender_codes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Male&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gender_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">gender_codes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gender_codes</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Define function to get average demographics of clients for a user</span>
<span class="k">def</span> <span class="nf">get_user_stats</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="n">user_clients</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">]</span>
    <span class="n">user_clients</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">avg_age</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">user_clients</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">mode_marital_status_code</span> <span class="o">=</span> <span class="n">user_clients</span><span class="p">[</span><span class="s1">&#39;maritalstatus_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">user_clients</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">mode_marital_status</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">marital_status_codes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">mode_marital_status_code</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">mode_gender_code</span> <span class="o">=</span> <span class="n">user_clients</span><span class="p">[</span><span class="s1">&#39;gender_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">user_clients</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">mode_gender</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">gender_codes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">mode_gender_code</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Average Age&#39;</span><span class="p">:</span> <span class="n">avg_age</span><span class="p">,</span> <span class="s1">&#39;Average Marital Status&#39;</span><span class="p">:</span> <span class="n">mode_marital_status</span><span class="p">,</span> <span class="s1">&#39;Average Gender&#39;</span><span class="p">:</span> <span class="n">mode_gender</span><span class="p">}</span>

<span class="c1"># Get list of unique user names</span>
<span class="n">df_users</span> <span class="o">=</span> <span class="n">df_users</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Surname&quot;</span><span class="p">)</span>
<span class="n">user_names</span> <span class="o">=</span> <span class="n">df_users</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Create dropdown menu of user names</span>
<span class="n">user_dropdown</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">user_names</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Select a User&#39;</span><span class="p">)</span>

<span class="c1"># Define function to display average demographics for selected user</span>
<span class="k">def</span> <span class="nf">display_user_stats</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="n">user_stats</span> <span class="o">=</span> <span class="n">get_user_stats</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">user_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Tie dropdown menu to function that displays user stats</span>
<span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">display_user_stats</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user_dropdown</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1030         AFSANA ABBUBAKER
1937       ZAAHID ABDUL HAMID
1949           WARREN ABRAHAM
633          DESIREE ABRAHAMS
1523         STEPHEN ABRAHAMS
                ...          
2110       Henry van Deventer
1104      Charlene van Staden
2191           Hentus van Wyk
1703    Theunis van der Stoep
606       Johan van der Vyver
Name: full_name, Length: 2247, dtype: object
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9a0ee63423c84ab599e9ac7a6d705fc9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Analyzing product types by demographic groups</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge data</span>
<span class="c1"># lst = [df_clients_holdings_assets_users]</span>
<span class="c1"># del df_clients_holdings_assets_users</span>
<span class="c1"># del lst</span>
<span class="n">df_clients</span> <span class="o">=</span> <span class="n">df_clients</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clientid&#39;</span><span class="p">:</span> <span class="s1">&#39;individualclientid&#39;</span><span class="p">})</span>
<span class="n">df_clients_holdings_assets_users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_clients</span><span class="p">,</span> <span class="n">df_assets</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;individualclientid&#39;</span><span class="p">)</span>
<span class="n">df_clients_holdings_assets_users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_clients_holdings_assets_users</span><span class="p">,</span> <span class="n">df_users</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;userid&#39;</span><span class="p">)</span>
<span class="c1"># df_clients_holdings_assets_users = pd.merge(df_clients, df_holdings, on=&#39;individualclientid&#39;)</span>

<span class="c1"># pd.set_option(&#39;display.max_columns&#39;, 100)</span>
<span class="c1"># print(df_clients_holdings_assets_users.sample(20))</span>

<span class="c1"># Assign codes to categorical variables</span>
<span class="c1"># marital_status_codes = {&#39;Married&#39;: 2, &#39;Single&#39;: 1, &#39;Divorced&#39;: 0, &#39;Widowed&#39;: -1, np.nan: None, None: None}</span>
<span class="c1"># df_clients_holdings_assets_users[&#39;maritalstatus&#39;] = df_clients_holdings_assets_users[&#39;maritalstatus&#39;].str.replace(r&#39;married.*&#39;, &#39;Married&#39;, case=False, regex=True)</span>

<span class="c1"># marital_status_dict = {&#39;Single&#39;: &#39;Single&#39;, &#39;Divorced&#39;: &#39;Divorced&#39;, &#39;Married&#39;: &#39;Married&#39;, &#39;Widowed&#39;: &#39;Widowed&#39;, &#39;Separated&#39;: &#39;Separated&#39;, &#39;Registered Partnership&#39;: &#39;Registered Partnership&#39;, &#39;Other&#39;: &#39;Other&#39;, &#39;Engaged&#39;: &#39;Engaged&#39;, &#39;Common-Law Partnership&#39;: &#39;Common-Law Partnership&#39;, &#39;Domestic Partnership&#39;: &#39;Domestic Partnership&#39;}</span>
<span class="c1"># df_clients_holdings_assets_users[&#39;maritalstatus&#39;] = df_clients_holdings_assets_users[&#39;maritalstatus&#39;].replace(marital_status_dict)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">fuzzywuzzy</span> <span class="kn">import</span> <span class="n">process</span>

<span class="c1"># Define mapping</span>
<span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;In community of property&#39;</span><span class="p">:</span> <span class="s1">&#39;In Community of Property&#39;</span><span class="p">,</span>
    <span class="s1">&#39;In Community of Property Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Married In Community of Property Male&#39;</span><span class="p">,</span>
    <span class="s1">&#39;In Community of Property Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Married In Community of Property Female&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Out of community of property without accrual&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property without Accrual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Out of community of property without accrual Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property without Accrual Male&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Out of community of property without accrual Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property without Accrual Female&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Out Community of Property with Accrual Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property with Accrual Male&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Out Community of Property with Accrual Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property with Accrual Female&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Out of community of property with Accrual&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property with Accrual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Common Law Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Male Common Law&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Common Law Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Female Common Law&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Divorced Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Male Divorced&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Divorced Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Female Divorced&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Divorced Joint&#39;</span><span class="p">:</span> <span class="s1">&#39;Joint Divorced&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Married Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Male Married&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Married Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Female Married&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Married (In community of property)&#39;</span><span class="p">:</span> <span class="s1">&#39;Married In Community of Property&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Married (Out of community of property without accrual)&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property without Accrual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Single Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Male Single&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Single Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Female Single&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Widowed Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Male Widowed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Widowed Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Female Widowed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Engaged Male&#39;</span><span class="p">:</span> <span class="s1">&#39;Male Engaged&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Engaged Female&#39;</span><span class="p">:</span> <span class="s1">&#39;Female Engaged&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Married Out of Community of Property with Accrual&#39;</span><span class="p">:</span> <span class="s1">&#39;Married Out of Community of Property with Accrual&#39;</span>
<span class="p">}</span>

<span class="c1"># Convert column to string type</span>
<span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="c1"># Apply fuzzy matching</span>
<span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">process</span><span class="o">.</span><span class="n">extractOne</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Replace asset types with standardized asset types using mapping dictionary</span>
<span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

<span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">marital_status_codes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">marital_status_codes</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># # Sense check</span>
<span class="c1"># print(df_clients_holdings_assets_users[&#39;maritalstatus_code&#39;].tolist())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">gender_codes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Male&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;gender_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">gender_codes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gender_codes</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Defragment df</span>
<span class="n">df_clients_holdings_assets_users</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># # Remove the _x suffix from any column names</span>
<span class="c1"># df = df.rename(columns={col: col[:-2] for col in df_holdings.columns if col.endswith(&#39;_x&#39;)})</span>

<span class="c1"># Group data by demographics and product types</span>
<span class="n">grouped_data</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;maritalstatus_code&#39;</span><span class="p">,</span> <span class="s1">&#39;gender_code&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

<span class="c1"># Fill missing values with 0</span>
<span class="n">grouped_data</span> <span class="o">=</span> <span class="n">grouped_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># # Not working</span>
<span class="c1"># # Check if grouped_data is empty</span>
<span class="c1"># if grouped_data.empty:</span>
<span class="c1">#     print(&#39;No data available for any group&#39;)</span>
<span class="c1"># else:</span>
<span class="c1">#     # Get most commonly bought products for each demographic group</span>
<span class="c1">#     for i, group in grouped_data.groupby([&#39;maritalstatus_code&#39;, &#39;gender_code&#39;]):</span>
<span class="c1">#         if int(i[0]) in marital_status_codes and int(i[1]) in gender_codes:</span>
<span class="c1">#             print(f&#39;Most commonly bought products for {marital_status_codes[int(i[0])]} {gender_codes[int(i[1])]}:&#39;)</span>
<span class="c1">#         else:</span>
<span class="c1">#             print(&#39;Invalid marital status code or gender code&#39;)</span>

<span class="c1">#         subgroup = group[group[&#39;count&#39;] == group[&#39;count&#39;].max()]</span>
<span class="c1">#         if subgroup.empty:</span>
<span class="c1">#             print(&#39;No data available for this group&#39;)</span>

<span class="c1"># #         else:</span>
<span class="c1"># #             print(subgroup)</span>
    
<span class="c1"># OR</span>

<span class="c1"># Determine most common holding type for each demographic group</span>
<span class="n">marital_gender_assettype</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">],</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># # Method 1 - prints types only</span>
<span class="c1"># # Print results</span>
<span class="c1"># for index, row in marital_gender_assettype.iterrows():</span>
<span class="c1">#     if row[&#39;type&#39;] == &#39;&#39;:</span>
<span class="c1">#         print(f&quot;No data available for {row[&#39;maritalstatus&#39;]} {row[&#39;gender&#39;]}&quot;)</span>
<span class="c1">#     else:</span>
<span class="c1">#         print(f&quot;Most common asset type for {row[&#39;maritalstatus&#39;]} {row[&#39;gender&#39;]} is {row[&#39;type&#39;]}&quot;)</span>

<span class="c1"># # Method 2 - prints statements on most common asset types per category</span>
<span class="c1"># # Create a dictionary to map asset type codes to descriptions</span>
<span class="c1"># asset_type_dict = df_clients_holdings_assets_users[[&#39;type&#39;, &#39;description&#39;]].drop_duplicates().set_index(&#39;type&#39;)[&#39;description&#39;].to_dict()</span>

<span class="c1"># # Print results</span>
<span class="c1"># for index, row in marital_gender_assettype.iterrows():</span>
<span class="c1">#     asset_type_desc = asset_type_dict.get(row[&#39;type&#39;], &#39;No data available&#39;)</span>
<span class="c1">#     if asset_type_desc == &#39;No data available&#39;:</span>
<span class="c1">#         print(f&quot;No data available for {row[&#39;maritalstatus&#39;]} {row[&#39;gender&#39;]}&quot;)</span>
<span class="c1">#     else:</span>
<span class="c1">#         asset_type_desc = asset_type_desc.split(&#39;:&#39;, 1)[-1].strip()  # remove anything before a colon</span>
<span class="c1">#         print(f&quot;Most common asset type for {row[&#39;maritalstatus&#39;]} {row[&#39;gender&#39;]} is {asset_type_desc}&quot;)</span>

<span class="c1"># Method 3 - prints a nicely formulated table</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1"># Create a dictionary to map asset type codes to descriptions</span>
<span class="n">asset_type_dict</span> <span class="o">=</span> <span class="n">df_clients_holdings_assets_users</span><span class="p">[[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

<span class="c1"># Create a list to store the table data</span>
<span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through the rows of marital_gender_assettype and append the formatted data to the table data list</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">marital_gender_assettype</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">asset_type_desc</span> <span class="o">=</span> <span class="n">asset_type_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="s1">&#39;No data available&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">asset_type_desc</span> <span class="o">==</span> <span class="s1">&#39;No data available&#39;</span><span class="p">:</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">],</span> <span class="n">asset_type_desc</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">],</span> <span class="n">asset_type_desc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()])</span>

<span class="c1"># Print the formatted table</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Marital Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">,</span> <span class="s1">&#39;Most Common Asset Type&#39;</span><span class="p">]))</span>

<span class="c1"># Method 4 - pivot table and heatmap</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>

<span class="c1"># Create a new column with the asset type description for each row</span>
<span class="n">marital_gender_assettype</span><span class="p">[</span><span class="s1">&#39;asset_type_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">marital_gender_assettype</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">asset_type_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;No data available&#39;</span><span class="p">))</span>

<span class="c1"># Remove anything before the colon in the description column</span>
<span class="n">marital_gender_assettype</span><span class="p">[</span><span class="s1">&#39;asset_type_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">marital_gender_assettype</span><span class="p">[</span><span class="s1">&#39;asset_type_desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="c1"># Create a LabelEncoder to encode the asset_type_desc column</span>
<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">marital_gender_assettype</span><span class="p">[</span><span class="s1">&#39;asset_type_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">marital_gender_assettype</span><span class="p">[</span><span class="s1">&#39;asset_type_desc&#39;</span><span class="p">])</span>

<span class="c1"># Create a pivot table of the marital_gender_assettype dataframe</span>
<span class="n">pt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">marital_gender_assettype</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;asset_type_code&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;maritalstatus&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>

<span class="c1"># Create a heatmap of the pivot table using the asset_type_code column as the values</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Asset Type Code&#39;</span><span class="p">})</span>

<span class="c1"># Get the ticklabels for the colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span>
<span class="n">ticklabels</span> <span class="o">=</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span>

<span class="c1"># Map the ticklabels to the asset_type_desc using the LabelEncoder</span>
<span class="n">ticklabel_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticklabels</span><span class="p">]</span>
<span class="n">ticklabel_descriptions</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">ticklabel_values</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ticklabel_descriptions</span><span class="p">)</span>

<span class="c1"># Set the x and y axis labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Marital Status&#39;</span><span class="p">)</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[None &#39;Male&#39; &#39;Female&#39; &#39;None&#39;]
Marital Status                                        Gender    Most Common Asset Type
----------------------------------------------------  --------  ------------------------
In Community of Property                              Female    Thailand
In Community of Property                              Male      Thailand
Male Common Law                                       Female    Sandton
Male Common Law                                       Male      Primary Residence
Male Divorced                                         Female    Golf
Male Divorced                                         Male      Golf
Male Engaged                                          Female    Golf
Male Engaged                                          Male      Golf
Male Married                                          Male      Livestock
Male Single                                           Female    Golf
Male Single                                           Male      Golf
Male Single                                           None      Golf
Male Widowed                                          Female    Golf
Male Widowed                                          Male      Golf
Married In Community of Property                      Female    Other Property
Married In Community of Property                      Male      Sandton
Married Out of Community of Property with Accrual     Female    Golf
Married Out of Community of Property with Accrual     Male      Golf
Married Out of Community of Property without Accrual  Female    Golf
Married Out of Community of Property without Accrual  Male      Golf
</pre></div>
</div>
<img alt="_images/97f08a23fad18540f43098795024f0e39538a5bcd09b579ac26a22686088018b.png" src="_images/97f08a23fad18540f43098795024f0e39538a5bcd09b579ac26a22686088018b.png" />
</div>
</div>
<div class="alert alert-block alert-info">
<b>Conclusion:</b> Insights here.
</div></section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ryanblumenow/avalondatalab",
            ref: "gh-pages",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="home.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Allegiance Consulting</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ryan Blumenow
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>